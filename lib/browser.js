!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){var r;!function(n){"use strict";function i(){if(i.prototype._singleton)throw new Error("WebMidi is a singleton, it cannot be instantiated directly.");i.prototype._singleton=this,this._inputs=[],this._outputs=[],this._userHandlers={},this._stateChangeQueue=[],this._processingStateChange=!1,this._midiInterfaceEvents=["connected","disconnected"],this._notes=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],this._semitones={C:0,D:2,E:4,F:5,G:7,A:9,B:11},Object.defineProperties(this,{MIDI_SYSTEM_MESSAGES:{value:{sysex:240,timecode:241,songposition:242,songselect:243,tuningrequest:246,sysexend:247,clock:248,start:250,continue:251,stop:252,activesensing:254,reset:255,midimessage:0,unknownsystemmessage:-1},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MESSAGES:{value:{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,channelmode:11,programchange:12,channelaftertouch:13,pitchbend:14},writable:!1,enumerable:!0,configurable:!1},MIDI_REGISTERED_PARAMETER:{value:{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]},writable:!1,enumerable:!0,configurable:!1},MIDI_CONTROL_CHANGE_MESSAGES:{value:{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MODE_MESSAGES:{value:{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127},writable:!1,enumerable:!0,configurable:!1},octaveOffset:{value:0,writable:!0,enumerable:!0,configurable:!1}}),Object.defineProperties(this,{supported:{enumerable:!0,get:function(){return"requestMIDIAccess"in navigator}},enabled:{enumerable:!0,get:function(){return void 0!==this.interface}.bind(this)},inputs:{enumerable:!0,get:function(){return this._inputs}.bind(this)},outputs:{enumerable:!0,get:function(){return this._outputs}.bind(this)},sysexEnabled:{enumerable:!0,get:function(){return!(!this.interface||!this.interface.sysexEnabled)}.bind(this)},time:{enumerable:!0,get:function(){return performance.now()}}})}function o(e){var t=this;this._userHandlers={channel:{},system:{}},this._midiInput=e,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return t._midiInput.connection}},id:{enumerable:!0,get:function(){return t._midiInput.id}},manufacturer:{enumerable:!0,get:function(){return t._midiInput.manufacturer}},name:{enumerable:!0,get:function(){return t._midiInput.name}},state:{enumerable:!0,get:function(){return t._midiInput.state}},type:{enumerable:!0,get:function(){return t._midiInput.type}}}),this._initializeUserHandlers(),this._midiInput.onmidimessage=this._onMidiMessage.bind(this)}function s(e){var t=this;this._midiOutput=e,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return t._midiOutput.connection}},id:{enumerable:!0,get:function(){return t._midiOutput.id}},manufacturer:{enumerable:!0,get:function(){return t._midiOutput.manufacturer}},name:{enumerable:!0,get:function(){return t._midiOutput.name}},state:{enumerable:!0,get:function(){return t._midiOutput.state}},type:{enumerable:!0,get:function(){return t._midiOutput.type}}})}var a=new i;i.prototype.enable=function(e,t){return this.enabled?void 0:this.supported?void navigator.requestMIDIAccess({sysex:t}).then(function(t){function n(){clearTimeout(r),this._updateInputsAndOutputs(),this.interface.onstatechange=this._onInterfaceStateChange.bind(this),"function"==typeof e&&e.call(this),i.forEach(function(e){this._onInterfaceStateChange(e)}.bind(this))}var r,i=[],o=[];this.interface=t,this._resetInterfaceUserHandlers(),this.interface.onstatechange=function(e){i.push(e)};for(var s=t.inputs.values(),a=s.next();a&&!a.done;a=s.next())o.push(a.value.open());for(var u=t.outputs.values(),h=u.next();h&&!h.done;h=u.next())o.push(h.value.open());r=setTimeout(n.bind(this),200),Promise&&Promise.all(o).catch(function(e){}).then(n.bind(this))}.bind(this),function(t){"function"==typeof e&&e.call(this,t)}.bind(this)):void("function"==typeof e&&e(new Error("The Web MIDI API is not supported by your browser.")))},i.prototype.disable=function(){if(!this.supported)throw new Error("The Web MIDI API is not supported by your browser.");this.interface&&(this.interface.onstatechange=void 0),this.interface=void 0,this._inputs=[],this._outputs=[],this._resetInterfaceUserHandlers()},i.prototype.addListener=function(e,t){if(!this.enabled)throw new Error("WebMidi must be enabled before adding event listeners.");if("function"!=typeof t)throw new TypeError("The 'listener' parameter must be a function.");if(!(this._midiInterfaceEvents.indexOf(e)>=0))throw new TypeError("The specified event type is not supported.");return this._userHandlers[e].push(t),this},i.prototype.hasListener=function(e,t){if(!this.enabled)throw new Error("WebMidi must be enabled before checking event listeners.");if("function"!=typeof t)throw new TypeError("The 'listener' parameter must be a function.");if(!(this._midiInterfaceEvents.indexOf(e)>=0))throw new TypeError("The specified event type is not supported.");for(var n=0;n<this._userHandlers[e].length;n++)if(this._userHandlers[e][n]===t)return!0;return!1},i.prototype.removeListener=function(e,t){if(!this.enabled)throw new Error("WebMidi must be enabled before removing event listeners.");if(void 0!==t&&"function"!=typeof t)throw new TypeError("The 'listener' parameter must be a function.");if(this._midiInterfaceEvents.indexOf(e)>=0)if(t)for(var n=0;n<this._userHandlers[e].length;n++)this._userHandlers[e][n]===t&&this._userHandlers[e].splice(n,1);else this._userHandlers[e]=[];else{if(void 0!==e)throw new TypeError("The specified event type is not supported.");this._resetInterfaceUserHandlers()}return this},i.prototype.toMIDIChannels=function(e){var t;return(t="all"===e||void 0===e?["all"]:Array.isArray(e)?e:[e]).indexOf("all")>-1&&(t=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),t.map(function(e){return parseInt(e)}).filter(function(e){return e>=1&&16>=e})},i.prototype.getInputById=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var t=0;t<this.inputs.length;t++)if(this.inputs[t].id===e)return this.inputs[t];return!1},i.prototype.getOutputById=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var t=0;t<this.outputs.length;t++)if(this.outputs[t].id===e)return this.outputs[t];return!1},i.prototype.getInputByName=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var t=0;t<this.inputs.length;t++)if(~this.inputs[t].name.indexOf(e))return this.inputs[t];return!1},i.prototype.getOctave=function(e){return null!=e&&e>=0&&127>=e?Math.floor(Math.floor(e)/12-1)+Math.floor(a.octaveOffset):void 0},i.prototype.getOutputByName=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var t=0;t<this.outputs.length;t++)if(~this.outputs[t].name.indexOf(e))return this.outputs[t];return!1},i.prototype.guessNoteNumber=function(e){var t=!1;if(e&&e.toFixed&&e>=0&&127>=e?t=Math.round(e):parseInt(e)>=0&&parseInt(e)<=127?t=parseInt(e):("string"==typeof e||e instanceof String)&&(t=this.noteNameToNumber(e)),!1===t)throw new Error("Invalid input value ("+e+").");return t},i.prototype.noteNameToNumber=function(e){"string"!=typeof e&&(e="");var t=e.match(/([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)/i);if(!t)throw new RangeError("Invalid note name.");var n=a._semitones[t[1].toUpperCase()],r=12*(parseInt(t[3])+1-Math.floor(a.octaveOffset))+n;if(t[2].toLowerCase().indexOf("b")>-1?r-=t[2].length:t[2].toLowerCase().indexOf("#")>-1&&(r+=t[2].length),0>r||r>127)throw new RangeError("Invalid note name or note outside valid range.");return r},i.prototype._updateInputsAndOutputs=function(){this._updateInputs(),this._updateOutputs()},i.prototype._updateInputs=function(){for(var e=0;e<this._inputs.length;e++){for(var t=!0,n=this.interface.inputs.values(),r=n.next();r&&!r.done;r=n.next())if(this._inputs[e]._midiInput===r.value){t=!1;break}t&&this._inputs.splice(e,1)}this.interface&&this.interface.inputs.forEach(function(e){for(var t=!0,n=0;n<this._inputs.length;n++)this._inputs[n]._midiInput===e&&(t=!1);t&&this._inputs.push(new o(e))}.bind(this))},i.prototype._updateOutputs=function(){for(var e=0;e<this._outputs.length;e++){for(var t=!0,n=this.interface.outputs.values(),r=n.next();r&&!r.done;r=n.next())if(this._outputs[e]._midiOutput===r.value){t=!1;break}t&&this._outputs.splice(e,1)}this.interface&&this.interface.outputs.forEach(function(e){for(var t=!0,n=0;n<this._outputs.length;n++)this._outputs[n]._midiOutput===e&&(t=!1);t&&this._outputs.push(new s(e))}.bind(this))},i.prototype._onInterfaceStateChange=function(e){this._updateInputsAndOutputs();var t={timestamp:e.timeStamp,type:e.port.state};this.interface&&"connected"===e.port.state?"output"===e.port.type?t.port=this.getOutputById(e.port.id):"input"===e.port.type&&(t.port=this.getInputById(e.port.id)):t.port={connection:"closed",id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this._userHandlers[e.port.state].forEach(function(e){e(t)})},i.prototype._resetInterfaceUserHandlers=function(){for(var e=0;e<this._midiInterfaceEvents.length;e++)this._userHandlers[this._midiInterfaceEvents[e]]=[]},o.prototype.addListener=function(e,t,n){var r=this;if(void 0===t&&(t="all"),Array.isArray(t)||(t=[t]),t.forEach(function(e){if("all"!==e&&!(e>=1&&16>=e))throw new RangeError("The 'channel' parameter is invalid.")}),"function"!=typeof n)throw new TypeError("The 'listener' parameter must be a function.");if(void 0!==a.MIDI_SYSTEM_MESSAGES[e])this._userHandlers.system[e]||(this._userHandlers.system[e]=[]),this._userHandlers.system[e].push(n);else{if(void 0===a.MIDI_CHANNEL_MESSAGES[e])throw new TypeError("The specified event type is not supported.");if(t.indexOf("all")>-1){t=[];for(var i=1;16>=i;i++)t.push(i)}this._userHandlers.channel[e]||(this._userHandlers.channel[e]=[]),t.forEach(function(t){r._userHandlers.channel[e][t]||(r._userHandlers.channel[e][t]=[]),r._userHandlers.channel[e][t].push(n)})}return this},o.prototype.on=o.prototype.addListener,o.prototype.hasListener=function(e,t,n){var r=this;if("function"!=typeof n)throw new TypeError("The 'listener' parameter must be a function.");if(void 0===t&&(t="all"),t.constructor!==Array&&(t=[t]),void 0!==a.MIDI_SYSTEM_MESSAGES[e]){for(var i=0;i<this._userHandlers.system[e].length;i++)if(this._userHandlers.system[e][i]===n)return!0}else if(void 0!==a.MIDI_CHANNEL_MESSAGES[e]){if(t.indexOf("all")>-1){t=[];for(var o=1;16>=o;o++)t.push(o)}return!!this._userHandlers.channel[e]&&t.every(function(t){var i=r._userHandlers.channel[e][t];return i&&i.indexOf(n)>-1})}return!1},o.prototype.removeListener=function(e,t,n){var r=this;if(void 0!==n&&"function"!=typeof n)throw new TypeError("The 'listener' parameter must be a function.");if(void 0===t&&(t="all"),t.constructor!==Array&&(t=[t]),void 0!==a.MIDI_SYSTEM_MESSAGES[e])if(void 0===n)this._userHandlers.system[e]=[];else for(var i=0;i<this._userHandlers.system[e].length;i++)this._userHandlers.system[e][i]===n&&this._userHandlers.system[e].splice(i,1);else if(void 0!==a.MIDI_CHANNEL_MESSAGES[e]){if(t.indexOf("all")>-1){t=[];for(var o=1;16>=o;o++)t.push(o)}if(!this._userHandlers.channel[e])return this;t.forEach(function(t){var i=r._userHandlers.channel[e][t];if(i)if(void 0===n)r._userHandlers.channel[e][t]=[];else for(var o=0;o<i.length;o++)i[o]===n&&i.splice(o,1)})}else{if(void 0!==e)throw new TypeError("The specified event type is not supported.");this._initializeUserHandlers()}return this},o.prototype._initializeUserHandlers=function(){for(var e in a.MIDI_CHANNEL_MESSAGES)a.MIDI_CHANNEL_MESSAGES.hasOwnProperty(e)&&(this._userHandlers.channel[e]={});for(var t in a.MIDI_SYSTEM_MESSAGES)a.MIDI_SYSTEM_MESSAGES.hasOwnProperty(t)&&(this._userHandlers.system[t]=[])},o.prototype._onMidiMessage=function(e){if(this._userHandlers.system.midimessage.length>0){var t={target:this,data:e.data,timestamp:e.timeStamp,type:"midimessage"};this._userHandlers.system.midimessage.forEach(function(e){e(t)})}e.data[0]<240?this._parseChannelEvent(e):e.data[0]<=255&&this._parseSystemEvent(e)},o.prototype._parseChannelEvent=function(e){var t,n,r=e.data[0]>>4,i=1+(15&e.data[0]);e.data.length>1&&(t=e.data[1],n=e.data.length>2?e.data[2]:void 0);var o={target:this,data:e.data,timestamp:e.timeStamp,channel:i};r===a.MIDI_CHANNEL_MESSAGES.noteoff||r===a.MIDI_CHANNEL_MESSAGES.noteon&&0===n?(o.type="noteoff",o.note={number:t,name:a._notes[t%12],octave:a.getOctave(t)},o.velocity=n/127,o.rawVelocity=n):r===a.MIDI_CHANNEL_MESSAGES.noteon?(o.type="noteon",o.note={number:t,name:a._notes[t%12],octave:a.getOctave(t)},o.velocity=n/127,o.rawVelocity=n):r===a.MIDI_CHANNEL_MESSAGES.keyaftertouch?(o.type="keyaftertouch",o.note={number:t,name:a._notes[t%12],octave:a.getOctave(t)},o.value=n/127):r===a.MIDI_CHANNEL_MESSAGES.controlchange&&t>=0&&119>=t?(o.type="controlchange",o.controller={number:t,name:this.getCcNameByNumber(t)},o.value=n):r===a.MIDI_CHANNEL_MESSAGES.channelmode&&t>=120&&127>=t?(o.type="channelmode",o.controller={number:t,name:this.getChannelModeByNumber(t)},o.value=n):r===a.MIDI_CHANNEL_MESSAGES.programchange?(o.type="programchange",o.value=t):r===a.MIDI_CHANNEL_MESSAGES.channelaftertouch?(o.type="channelaftertouch",o.value=t/127):r===a.MIDI_CHANNEL_MESSAGES.pitchbend?(o.type="pitchbend",o.value=((n<<7)+t-8192)/8192):o.type="unknownchannelmessage",this._userHandlers.channel[o.type]&&this._userHandlers.channel[o.type][i]&&this._userHandlers.channel[o.type][i].forEach(function(e){e(o)})},o.prototype.getCcNameByNumber=function(e){if(!((e=Math.floor(e))>=0&&119>=e))throw new RangeError("The control change number must be between 0 and 119.");for(var t in a.MIDI_CONTROL_CHANGE_MESSAGES)if(a.MIDI_CONTROL_CHANGE_MESSAGES.hasOwnProperty(t)&&e===a.MIDI_CONTROL_CHANGE_MESSAGES[t])return t},o.prototype.getChannelModeByNumber=function(e){if(!((e=Math.floor(e))>=120&&status<=127))throw new RangeError("The control change number must be between 120 and 127.");for(var t in a.MIDI_CHANNEL_MODE_MESSAGES)if(a.MIDI_CHANNEL_MODE_MESSAGES.hasOwnProperty(t)&&e===a.MIDI_CHANNEL_MODE_MESSAGES[t])return t},o.prototype._parseSystemEvent=function(e){var t=e.data[0],n={target:this,data:e.data,timestamp:e.timeStamp};t===a.MIDI_SYSTEM_MESSAGES.sysex?n.type="sysex":t===a.MIDI_SYSTEM_MESSAGES.timecode?n.type="timecode":t===a.MIDI_SYSTEM_MESSAGES.songposition?n.type="songposition":t===a.MIDI_SYSTEM_MESSAGES.songselect?(n.type="songselect",n.song=e.data[1]):t===a.MIDI_SYSTEM_MESSAGES.tuningrequest?n.type="tuningrequest":t===a.MIDI_SYSTEM_MESSAGES.clock?n.type="clock":t===a.MIDI_SYSTEM_MESSAGES.start?n.type="start":t===a.MIDI_SYSTEM_MESSAGES.continue?n.type="continue":t===a.MIDI_SYSTEM_MESSAGES.stop?n.type="stop":t===a.MIDI_SYSTEM_MESSAGES.activesensing?n.type="activesensing":t===a.MIDI_SYSTEM_MESSAGES.reset?n.type="reset":n.type="unknownsystemmessage",this._userHandlers.system[n.type]&&this._userHandlers.system[n.type].forEach(function(e){e(n)})},s.prototype.send=function(e,t,n){if(!(e>=128&&255>=e))throw new RangeError("The status byte must be an integer between 128 (0x80) and 255 (0xFF).");void 0===t&&(t=[]),Array.isArray(t)||(t=[t]);var r=[];return t.forEach(function(e,t){var n=Math.floor(e);if(!(n>=0&&255>=n))throw new RangeError("Data bytes must be integers between 0 (0x00) and 255 (0xFF).");r.push(n)}),this._midiOutput.send([e].concat(r),parseFloat(n)||0),this},s.prototype.sendSysex=function(e,t,n){if(!a.sysexEnabled)throw new Error("Sysex message support must first be activated.");return n=n||{},e=[].concat(e),t.forEach(function(e){if(0>e||e>127)throw new RangeError("The data bytes of a sysex message must be integers between 0 (0x00) and 127 (0x7F).")}),t=e.concat(t,a.MIDI_SYSTEM_MESSAGES.sysexend),this.send(a.MIDI_SYSTEM_MESSAGES.sysex,t,this._parseTimeParameter(n.time)),this},s.prototype.sendTimecodeQuarterFrame=function(e,t){return t=t||{},this.send(a.MIDI_SYSTEM_MESSAGES.timecode,e,this._parseTimeParameter(t.time)),this},s.prototype.sendSongPosition=function(e,t){e=Math.floor(e)||0,t=t||{};var n=e>>7&127,r=127&e;return this.send(a.MIDI_SYSTEM_MESSAGES.songposition,[n,r],this._parseTimeParameter(t.time)),this},s.prototype.sendSongSelect=function(e,t){if(e=Math.floor(e),t=t||{},!(e>=0&&127>=e))throw new RangeError("The song number must be between 0 and 127.");return this.send(a.MIDI_SYSTEM_MESSAGES.songselect,[e],this._parseTimeParameter(t.time)),this},s.prototype.sendTuningRequest=function(e){return e=e||{},this.send(a.MIDI_SYSTEM_MESSAGES.tuningrequest,void 0,this._parseTimeParameter(e.time)),this},s.prototype.sendClock=function(e){return e=e||{},this.send(a.MIDI_SYSTEM_MESSAGES.clock,void 0,this._parseTimeParameter(e.time)),this},s.prototype.sendStart=function(e){return e=e||{},this.send(a.MIDI_SYSTEM_MESSAGES.start,void 0,this._parseTimeParameter(e.time)),this},s.prototype.sendContinue=function(e){return e=e||{},this.send(a.MIDI_SYSTEM_MESSAGES.continue,void 0,this._parseTimeParameter(e.time)),this},s.prototype.sendStop=function(e){return e=e||{},this.send(a.MIDI_SYSTEM_MESSAGES.stop,void 0,this._parseTimeParameter(e.time)),this},s.prototype.sendActiveSensing=function(e){return e=e||{},this.send(a.MIDI_SYSTEM_MESSAGES.activesensing,[],this._parseTimeParameter(e.time)),this},s.prototype.sendReset=function(e){return e=e||{},this.send(a.MIDI_SYSTEM_MESSAGES.reset,void 0,this._parseTimeParameter(e.time)),this},s.prototype.stopNote=function(e,t,n){if("all"===e)return this.sendChannelMode("allnotesoff",0,t,n);var r=64;return(n=n||{}).rawVelocity?!isNaN(n.velocity)&&n.velocity>=0&&n.velocity<=127&&(r=n.velocity):!isNaN(n.velocity)&&n.velocity>=0&&n.velocity<=1&&(r=127*n.velocity),this._convertNoteToArray(e).forEach(function(e){a.toMIDIChannels(t).forEach(function(t){this.send((a.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(t-1),[e,Math.round(r)],this._parseTimeParameter(n.time))}.bind(this))}.bind(this)),this},s.prototype.playNote=function(e,t,n){var r=64;if((n=n||{}).rawVelocity?!isNaN(n.velocity)&&n.velocity>=0&&n.velocity<=127&&(r=n.velocity):!isNaN(n.velocity)&&n.velocity>=0&&n.velocity<=1&&(r=127*n.velocity),n.time=this._parseTimeParameter(n.time),this._convertNoteToArray(e).forEach(function(e){a.toMIDIChannels(t).forEach(function(t){this.send((a.MIDI_CHANNEL_MESSAGES.noteon<<4)+(t-1),[e,Math.round(r)],n.time)}.bind(this))}.bind(this)),!isNaN(n.duration)){n.duration<=0&&(n.duration=0);var i=64;n.rawVelocity?!isNaN(n.release)&&n.release>=0&&n.release<=127&&(i=n.release):!isNaN(n.release)&&n.release>=0&&n.release<=1&&(i=127*n.release),this._convertNoteToArray(e).forEach(function(e){a.toMIDIChannels(t).forEach(function(t){this.send((a.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(t-1),[e,Math.round(i)],(n.time||a.time)+n.duration)}.bind(this))}.bind(this))}return this},s.prototype.sendKeyAftertouch=function(e,t,n,r){var i=this;if(r=r||{},1>t||t>16)throw new RangeError("The channel must be between 1 and 16.");(isNaN(n)||0>n||n>1)&&(n=.5);var o=Math.round(127*n);return this._convertNoteToArray(e).forEach(function(e){a.toMIDIChannels(t).forEach(function(t){i.send((a.MIDI_CHANNEL_MESSAGES.keyaftertouch<<4)+(t-1),[e,o],i._parseTimeParameter(r.time))})}),this},s.prototype.sendControlChange=function(e,t,n,r){if(r=r||{},"string"==typeof e){if(!(e=a.MIDI_CONTROL_CHANGE_MESSAGES[e]))throw new TypeError("Invalid controller name.")}else if(!((e=Math.floor(e))>=0&&119>=e))throw new RangeError("Controller numbers must be between 0 and 119.");if(!((t=Math.floor(t)||0)>=0&&127>=t))throw new RangeError("Controller value must be between 0 and 127.");return a.toMIDIChannels(n).forEach(function(n){this.send((a.MIDI_CHANNEL_MESSAGES.controlchange<<4)+(n-1),[e,t],this._parseTimeParameter(r.time))}.bind(this)),this},s.prototype._selectRegisteredParameter=function(e,t,n){var r=this;if(e[0]=Math.floor(e[0]),!(e[0]>=0&&e[0]<=127))throw new RangeError("The control65 value must be between 0 and 127");if(e[1]=Math.floor(e[1]),!(e[1]>=0&&e[1]<=127))throw new RangeError("The control64 value must be between 0 and 127");return a.toMIDIChannels(t).forEach(function(i){r.sendControlChange(101,e[0],t,{time:n}),r.sendControlChange(100,e[1],t,{time:n})}),this},s.prototype._selectNonRegisteredParameter=function(e,t,n){var r=this;if(e[0]=Math.floor(e[0]),!(e[0]>=0&&e[0]<=127))throw new RangeError("The control63 value must be between 0 and 127");if(e[1]=Math.floor(e[1]),!(e[1]>=0&&e[1]<=127))throw new RangeError("The control62 value must be between 0 and 127");return a.toMIDIChannels(t).forEach(function(i){r.sendControlChange(99,e[0],t,{time:n}),r.sendControlChange(98,e[1],t,{time:n})}),this},s.prototype._setCurrentRegisteredParameter=function(e,t,n){var r=this;if((e=[].concat(e))[0]=Math.floor(e[0]),!(e[0]>=0&&e[0]<=127))throw new RangeError("The msb value must be between 0 and 127");return a.toMIDIChannels(t).forEach(function(i){r.sendControlChange(6,e[0],t,{time:n})}),e[1]=Math.floor(e[1]),e[1]>=0&&e[1]<=127&&a.toMIDIChannels(t).forEach(function(i){r.sendControlChange(38,e[1],t,{time:n})}),this},s.prototype._deselectRegisteredParameter=function(e,t){var n=this;return a.toMIDIChannels(e).forEach(function(r){n.sendControlChange(101,127,e,{time:t}),n.sendControlChange(100,127,e,{time:t})}),this},s.prototype.setRegisteredParameter=function(e,t,n,r){var i=this;if(r=r||{},!Array.isArray(e)){if(!a.MIDI_REGISTERED_PARAMETER[e])throw new Error("The specified parameter is not available.");e=a.MIDI_REGISTERED_PARAMETER[e]}return a.toMIDIChannels(n).forEach(function(o){i._selectRegisteredParameter(e,n,r.time),i._setCurrentRegisteredParameter(t,n,r.time),i._deselectRegisteredParameter(n,r.time)}),this},s.prototype.setNonRegisteredParameter=function(e,t,n,r){var i=this;if(r=r||{},!(e[0]>=0&&e[0]<=127&&e[1]>=0&&e[1]<=127))throw new Error("Position 0 and 1 of the 2-position parameter array must both be between 0 and 127.");return t=[].concat(t),a.toMIDIChannels(n).forEach(function(o){i._selectNonRegisteredParameter(e,n,r.time),i._setCurrentRegisteredParameter(t,n,r.time),i._deselectRegisteredParameter(n,r.time)}),this},s.prototype.incrementRegisteredParameter=function(e,t,n){var r=this;if(n=n||{},!Array.isArray(e)){if(!a.MIDI_REGISTERED_PARAMETER[e])throw new Error("The specified parameter is not available.");e=a.MIDI_REGISTERED_PARAMETER[e]}return a.toMIDIChannels(t).forEach(function(i){r._selectRegisteredParameter(e,t,n.time),r.sendControlChange(96,0,t,{time:n.time}),r._deselectRegisteredParameter(t,n.time)}),this},s.prototype.decrementRegisteredParameter=function(e,t,n){if(n=n||{},!Array.isArray(e)){if(!a.MIDI_REGISTERED_PARAMETER[e])throw new TypeError("The specified parameter is not available.");e=a.MIDI_REGISTERED_PARAMETER[e]}return a.toMIDIChannels(t).forEach(function(r){this._selectRegisteredParameter(e,t,n.time),this.sendControlChange(97,0,t,{time:n.time}),this._deselectRegisteredParameter(t,n.time)}.bind(this)),this},s.prototype.setPitchBendRange=function(e,t,n,r){var i=this;if(r=r||{},!((e=Math.floor(e)||0)>=0&&127>=e))throw new RangeError("The semitones value must be between 0 and 127");if(!((t=Math.floor(t)||0)>=0&&127>=t))throw new RangeError("The cents value must be between 0 and 127");return a.toMIDIChannels(n).forEach(function(o){i.setRegisteredParameter("pitchbendrange",[e,t],n,{time:r.time})}),this},s.prototype.setModulationRange=function(e,t,n,r){var i=this;if(r=r||{},!((e=Math.floor(e)||0)>=0&&127>=e))throw new RangeError("The semitones value must be between 0 and 127");if(!((t=Math.floor(t)||0)>=0&&127>=t))throw new RangeError("The cents value must be between 0 and 127");return a.toMIDIChannels(n).forEach(function(o){i.setRegisteredParameter("modulationrange",[e,t],n,{time:r.time})}),this},s.prototype.setMasterTuning=function(e,t,n){var r=this;if(n=n||{},-65>=(e=parseFloat(e)||0)||e>=64)throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");var i=Math.floor(e)+64,o=e-Math.floor(e),s=(o=Math.round((o+1)/2*16383))>>7&127,u=127&o;return a.toMIDIChannels(t).forEach(function(e){r.setRegisteredParameter("channelcoarsetuning",i,t,{time:n.time}),r.setRegisteredParameter("channelfinetuning",[s,u],t,{time:n.time})}),this},s.prototype.setTuningProgram=function(e,t,n){var r=this;if(n=n||{},!((e=Math.floor(e))>=0&&127>=e))throw new RangeError("The program value must be between 0 and 127");return a.toMIDIChannels(t).forEach(function(i){r.setRegisteredParameter("tuningprogram",e,t,{time:n.time})}),this},s.prototype.setTuningBank=function(e,t,n){var r=this;if(n=n||{},!((e=Math.floor(e)||0)>=0&&127>=e))throw new RangeError("The bank value must be between 0 and 127");return a.toMIDIChannels(t).forEach(function(i){r.setRegisteredParameter("tuningbank",e,t,{time:n.time})}),this},s.prototype.sendChannelMode=function(e,t,n,r){if(r=r||{},"string"==typeof e){if(!(e=a.MIDI_CHANNEL_MODE_MESSAGES[e]))throw new TypeError("Invalid channel mode message name.")}else if(!((e=Math.floor(e))>=120&&127>=e))throw new RangeError("Channel mode numerical identifiers must be between 120 and 127.");if(0>(t=Math.floor(t)||0)||t>127)throw new RangeError("Value must be an integer between 0 and 127.");return a.toMIDIChannels(n).forEach(function(n){this.send((a.MIDI_CHANNEL_MESSAGES.channelmode<<4)+(n-1),[e,t],this._parseTimeParameter(r.time))}.bind(this)),this},s.prototype.sendProgramChange=function(e,t,n){var r=this;if(n=n||{},e=Math.floor(e),isNaN(e)||0>e||e>127)throw new RangeError("Program numbers must be between 0 and 127.");return a.toMIDIChannels(t).forEach(function(t){r.send((a.MIDI_CHANNEL_MESSAGES.programchange<<4)+(t-1),[e],r._parseTimeParameter(n.time))}),this},s.prototype.sendChannelAftertouch=function(e,t,n){var r=this;n=n||{},e=parseFloat(e),(isNaN(e)||0>e||e>1)&&(e=.5);var i=Math.round(127*e);return a.toMIDIChannels(t).forEach(function(e){r.send((a.MIDI_CHANNEL_MESSAGES.channelaftertouch<<4)+(e-1),[i],r._parseTimeParameter(n.time))}),this},s.prototype.sendPitchBend=function(e,t,n){var r=this;if(n=n||{},isNaN(e)||-1>e||e>1)throw new RangeError("Pitch bend value must be between -1 and 1.");var i=Math.round((e+1)/2*16383),o=i>>7&127,s=127&i;return a.toMIDIChannels(t).forEach(function(e){r.send((a.MIDI_CHANNEL_MESSAGES.pitchbend<<4)+(e-1),[s,o],r._parseTimeParameter(n.time))}),this},s.prototype._parseTimeParameter=function(e){var t,n;return"string"==typeof e&&"+"===e.substring(0,1)?(t=parseFloat(e))&&t>0&&(n=a.time+t):(t=parseFloat(e))>a.time&&(n=t),n},s.prototype._convertNoteToArray=function(e){var t=[];return Array.isArray(e)||(e=[e]),e.forEach(function(e){t.push(a.guessNoteNumber(e))}),t},void 0===(r=function(){return a}.apply(t,[]))||(e.exports=r)}()},function(e,t){e.exports=osc},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Dispatcher=class{constructor(){const e=document.createTextNode(null);this.addEventListener=e.addEventListener.bind(e),this.removeEventListener=e.removeEventListener.bind(e),this.dispatchEvent=e.dispatchEvent.bind(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Loop=class{constructor({handler:e,name:t}){this.isSleeping=!1,this.ticksToSleep=-1,this.lastTickCalled=-1,this.handler=e.bind(this),this.name=t,this.isDead=!1}sleep(e){return this.ticksToSleep=e,this.isSleeping=!0,new Promise((e,t)=>{})}destroy(){this.isDead=!0,this.handler=null}run(e){this.tick=e,this.ticksToSleep--,this.ticksToSleep<=0&&(this.isSleeping=!1),this.isSleeping||this.isDead||this.lastTickCalled===e||(this.lastTickCalled=e,this.handler(this))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(3),i=n(2),o=60,s=24,a={TICK:"TICK",BEAT:"BEAT"},u=e=>6e4/e/s;class h{constructor(){this.timerWorker=null,this.oscillator=null,this.lastScheduledTickTimestamp=Date.now(),this.pendingTicks=new Set,this.hasStopped=!1,this.dispatcher=null,this.bufferQueue=[],this.newLoopsQueue=[],this.tick=0,this.beat=0,this.loops={},this.T=s,this.M=4*s,this.onTick=(e=>{this.incrementTicks(),this.scheduleTicks(h.DEFAULT_TICKS_TO_SCHEDULE,this.getCurrentTick())}),this.onBeat=(e=>{this.drainRegisterLoopQueue()}),this.onMessage=(e=>{const t=(e.address||"").split("/");if("buffer"===t[1]&&(console.log("loop change detected"),this.bufferQueue.push(t.slice(2).join("/"))),"midi"===t[1]){if("beat"===t[2]||this.tick%24==0){this.beat++;const e=new CustomEvent(a.BEAT,{});this.dispatcher.dispatchEvent(e)}if("tick"===t[2]){const e=new CustomEvent(a.TICK,{});this.dispatcher.dispatchEvent(e)}}}),this.registerLoop=((e,t)=>{console.log("REGISTER LOOP",e,t),this.newLoopsQueue.push({name:e,handler:t})}),this.setTempo=(e=>{if(h.USE_BROWSER_CLOCK)return h.currentBrowserBPM=e,this.tickInterval=u(e),void this.timerWorker.postMessage({interval:this.tickInterval});fetch(`http://${window.location.host}/updateBpm`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({bpm:e})}).then(e=>{console.log("BPM updated",e.json())})}),this.playNote=(e=>{const t=this.context,n=t.createOscillator();n.type="sine",n.frequency.value=e,n.connect(t.destination),n.start(0),this.oscillator=n,setTimeout(()=>{this.oscillator.stop(0)},100)}),this.getOutputs=(()=>{h.MIDI.enable(function(e){e?console.log("WebMidi could not be enabled.",e):console.log("WebMidi enabled!")})})}init(e){this.setAudioContext(),this.setDispatcher(),this.setTickInterval(),this.startClock(),this.setGlobals(window)}setDispatcher(e=i.Dispatcher){this.dispatcher=new e,this.dispatcher.addEventListener(a.TICK,this.onTick),this.dispatcher.addEventListener(a.BEAT,this.onBeat)}setAudioContext(e=AudioContext){this.context=new e}setTickInterval(e=o){this.tickInterval=h.calcTickInterval(e)}start(){this.hasStopped=!1,this.timerWorker.postMessage("start")}stop(){this.hasStopped=!0,this.timerWorker.postMessage("stop")}incrementTicks(){this.tick++}getCurrentTick(){return Number(this.tick)}drainRegisterLoopQueue(){for(;this.newLoopsQueue.length>0;){const e=this.loops,{name:t,handler:n}=this.newLoopsQueue.pop();if(e[t]){e[t].destroy(),delete e[t]}e[t]=new r.Loop({name:t,handler:n})}}loadBuffer(e){const t=document.querySelectorAll(".buffer-script");Array.from(t).forEach(e=>e.remove());const n=document.createElement("script"),r=Date.now();n.src=`${e}?${r}`,n.className="buffer-script",document.body.appendChild(n)}processLoops(e){Object.keys(this.loops).forEach(t=>{this.loops[t].run(e)}),this.pendingTicks.delete(e)}processBuffers(){for(console.log("PROCESSING BUFFERS",this.bufferQueue);this.bufferQueue.length;)this.loadBuffer(this.bufferQueue.shift())}scheduleTicks(e,t){const n=this.lastScheduledTickTimestamp,r=Date.now();if(r-n>h.LOOKAHEAD){if(this.hasStopped)return;const n=e;let i=0;for(;i<=n+1;){let e=t+i;this.pendingTicks.has(e)?i++:(this.scheduleTick(e,i),i++)}this.processBuffers(),this.lastScheduledTickTimestamp=r}}scheduleTick(e,t){this.pendingTicks.add(e),this.timerWorker.postMessage({scheduleLoop:!0,tickID:e,queueRank:t,tickInterval:this.tickInterval})}startTimerWorker(){this.timerWorker=new Worker("/lib/worker.js"),this.timerWorker.onmessage=(e=>{if("tick"===e.data)this.onMessage({address:"/midi/tick"});else if(e.data&&"processLoops"===e.data.event){const{tick:t}=e.data;this.processLoops(t)}else console.log("message",e.data)}),this.timerWorker.postMessage("start")}startOSCListen(){let e=new h.OSC.WebSocketPort({url:`ws://${window.location.host}`});e.on("message",this.onMessage),e.open()}setupMIDI(){h.MIDI.enable(function(e){e?console.log("WebMidi could not be enabled.",e):console.log("WebMidi enabled!")})}startClock(){h.USE_BROWSER_CLOCK&&this.startTimerWorker(),this.startOSCListen(),this.setupMIDI()}setGlobals(e){e.loop=this.registerLoop,e.setTempo=this.setTempo,e.playNote=this.playNote,e.tickInterval=this.tickInterval,e.T=this.T,e.M=this.M,e.sqcr=this,e.BrowserClient=h}}h.EVENTS=a,h.LOOKAHEAD=1e3,h.USE_BROWSER_CLOCK=!1,h.DEFAULT_BPM=o,h.DEFAULT_TICKS_TO_SCHEDULE=100,h.currentBrowserBPM=o,h.calcTickInterval=u,t.BrowserClient=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(4),i=n(1),o=n(0);r.BrowserClient.OSC=i,r.BrowserClient.MIDI=o,r.BrowserClient.USE_BROWSER_CLOCK=!0;const s=new r.BrowserClient;console.log("BS",s),s.init()}]);