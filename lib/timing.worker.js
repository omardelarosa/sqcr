!function(e){var t={};function s(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(r,a,function(t){return e[t]}.bind(null,a));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=3)}([function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Dispatcher=class{constructor(){const e=document.createTextNode(null);this.addEventListener=e.addEventListener.bind(e),this.removeEventListener=e.removeEventListener.bind(e),this.dispatchEvent=e.dispatchEvent.bind(e)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(0);t.EventEmitter=class{constructor(e){this.dispatcher=e||new r.Dispatcher}on(e,t){this.dispatcher.addEventListener(e,t)}emit(e,t){const s=new CustomEvent(e,t);this.dispatcher.dispatchEvent(s)}off(e,t){this.dispatcher.removeEventListener(e,t)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(1),a=24,n=60,i=1e3,o=e=>6e4/e/a;t.bindTimingWorkerOnMessageHandler=(e=>{const t=new class{constructor(e,t){this.bpm=e,this.timerID=0,this.setBPM({bpm:e}),this.scheduledTicks=new Set,this.ctx=t}onError(e){this.ctx.postMessage({event:"error",message:e})}onEvent(e){const t=e.data&&e.data.action||"error";if("error"!==t)switch(t){case"start":this.start(e.data.payload);break;case"updateInterval":this.updateInterval(e.data.payload);break;case"stop":this.stop();break;default:console.warn("Worker received unhandled action: "+t)}else this.onError(`Unsupport timing action ${t}`)}setBPM({bpm:e}){this.interval=o(e)}updateInterval({bpm:e}){clearInterval(this.timerID),this.setBPM(e);const t=a*this.interval;this.timerID=setInterval(()=>{this.scheduleTicks()},t)}start({bpm:e}){console.log("starting at BPM: ",e),this.updateInterval({bpm:e})}stop(){console.log("stopping"),this.scheduledTicks.forEach(e=>{clearTimeout(e),this.scheduledTicks.delete(e)}),clearInterval(this.timerID),this.timerID=0}scheduleTicks(){let e=1,t=0;for(;t<i;){const s=e*this.interval;let r=setTimeout(()=>{this.scheduledTicks.has(r)&&(this.sendToTransport("tick"),this.scheduledTicks.delete(r))},s);this.scheduledTicks.add(r),e++,t+=s}}sendToTransport(e,t){this.ctx.postMessage({action:e,payload:t})}}(n,e);return e=>{try{t.onEvent(e)}catch(e){t.onError(e.message)}}});class c{constructor(e={}){this.events=null,this.beat=0,this.tick=0,this.bpm=n,this.onMessage=(e=>{const t=c.EVENTS,s=e.name||e.data.action;switch(s){case"buffer":console.log("loop change detected"),this.events.emit(t.BUFFER,{adress:e.address,payload:e.data.payload});break;case"beat":this.incrementBeat(),this.events.emit(t.BEAT,e.data.payload);break;case"tick":this.incrementTick(),this.events.emit(t.TICK,e.data.payload);break;case"processLoops":this.events.emit(t.PROCESS_LOOPS,e.data.payload);break;case"updateBPM":this.updateBPM(e.data.payload.bpm),this.events.emit(t.UPDATE_BPM,e.data.payload);break;case"start":this.start(e.data.payload),this.events.emit(t.START,e.data.payload);break;case"stop":this.stop(),this.events.emit(t.STOP,e.data.payload);break;default:console.error("Unhandled transport event: ",s,e),this.stop()}}),this.events=new r.EventEmitter,this.bpm=e.bpm}getTick(){return+this.tick}getBeat(){return+this.beat}getBPM(){return+this.bpm}incrementBeat(){this.beat++}incrementTick(){this.tick++}processLoops({tick:e}){console.log("TODO: processLoops!")}sendToWorker(e,t){this.timerWorker.postMessage({action:e,payload:t})}static toEvent(e){return{name:(e.address||"").split("/")[1],data:e}}bindTimerWorkerListeners(e,t){e.onmessage=(e=>{this.onMessage(e)}),e.onerror=t}startTimerWorker(e){this.timerWorker=e,this.bindTimerWorkerListeners(this.timerWorker,e=>{console.error("Worker error: ",e.message)}),this.start({bpm:this.bpm})}start({bpm:e}){this.sendToWorker("start",{bpm:e})}stop(){this.sendToWorker("stop",{})}updateBPM(e){this.sendToWorker("updateInterval",{bpm:e})}}c.EVENTS={TICK:"TICK",BEAT:"BEAT",BUFFER:"BUFFER",PROCESS_LOOPS:"PROCESS_LOOPS",STOP:"STOP",START:"START",UPDATE_BPM:"UPDATE_BPM"},c.DEFAULT_TICK_RESOLUTION=a,c.DEFAULT_LOOKAHEAD_MS=i,c.DEFAULT_BPM=n,t.Transport=c,t.default=c},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(2),a=self;a.onmessage=r.bindTimingWorkerOnMessageHandler(a)}]);